<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- CLAIM OWNERSHIP -->
<meta name="x-ogp-key" content="9063cd14-6bfe-4820-964a-0194b9ac0569"/>

<title>Dodge Arena: Double or Die</title>

<!-- PLAY.FUN SDK -->
<script src="https://play.fun/sdk.js"></script>

<style>
body{margin:0;overflow:hidden;background:#050505;color:#fff;font-family:Arial}
#ui{position:absolute;top:10px;left:10px}
#score{font-size:20px}
#streak{font-size:14px;color:#f1c40f}
#daily{font-size:12px;color:#9b59b6}

#panel{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
background:#111;padding:22px;
border-radius:14px;text-align:center;
display:none;max-width:90%
}

button{
padding:14px 26px;
margin:6px;
border:none;
border-radius:10px;
font-size:16px;
cursor:pointer;
}

.cont{background:#2ecc71;color:#000}
.risk{background:#e67e22}
.cash{background:#3498db}
.share{background:#9b59b6}
.small{font-size:13px;opacity:.8}
</style>
</head>

<body>

<div id="ui">
  <div id="score">Score: 0</div>
  <div id="streak">ðŸ”¥ Streak: 0</div>
  <div id="daily"></div>
</div>

<div id="panel">
  <h2>YOU DIED ðŸ’€</h2>
  <p id="final"></p>

  <!-- $$$ MAIN MONEY BUTTON -->
  <button class="cont" onclick="continueAd()">ðŸ“º SAVE RUN (FREE)</button><br>

  <button class="risk" onclick="risk(2,0.7)">x2 (70%)</button>
  <button class="risk" onclick="risk(4,0.45)">x4 (45%)</button>
  <button class="risk" onclick="risk(8,0.25)">x8 (25%)</button><br>

  <button class="cash" onclick="cashOut()">ðŸ’° CASH OUT</button><br>
  <button class="share" onclick="share()">ðŸ”— CHALLENGE FRIENDS</button><br>
  <button class="small" onclick="restart()">PLAY AGAIN</button>
</div>

<canvas id="game"></canvas>

<script>
/* ================= PLAY.FUN INIT ================= */
const PF = window.PlayFun || null;
if(PF) PF.startGame();

/* ================= GAME STATE ================= */
const c=document.getElementById("game"),ctx=c.getContext("2d");
c.width=innerWidth;c.height=innerHeight;

let p={x:c.width/2-20,y:c.height-60,w:40,h:40};
let saws=[],score=0,streak=0,running=true,slow=1;
let best=localStorage.getItem("best")||0;
let saveUsed=false;

/* ================= DAILY MODIFIER ================= */
let today=new Date().toDateString();
let last=localStorage.getItem("day");
let dailyHard=false;
if(today!==last){
 localStorage.setItem("day",today);
 dailyHard=Math.random()<0.5;
 localStorage.setItem("dailyHard",dailyHard);
}
dailyHard=localStorage.getItem("dailyHard")==="true";
document.getElementById("daily").innerText=
 dailyHard?"âš ï¸ Daily Arena: HARD MODE":"âœ¨ Daily Arena: NORMAL";

/* ================= INPUT ================= */
document.addEventListener("mousemove",e=>p.x=e.clientX-p.w/2);
document.addEventListener("touchmove",e=>p.x=e.touches[0].clientX-p.w/2);

/* ================= SPAWN ================= */
function spawn(){
 saws.push({
  x:Math.random()*(c.width-40),
  y:-40,
  r:20,
  a:0,
  s:(3+score*0.04)*(dailyHard?1.25:1)
 });
}

/* ================= LOOP ================= */
function loop(){
 if(!running)return;
 ctx.clearRect(0,0,c.width,c.height);

 document.body.style.background =
 score>80?"#300":score>40?"#150":"#050505";

 ctx.fillStyle="lime";
 ctx.fillRect(p.x,p.y,p.w,p.h);

 saws.forEach((s,i)=>{
  s.y+=s.s*slow;
  s.a+=0.25;
  ctx.save();
  ctx.translate(s.x+s.r,s.y+s.r);
  ctx.rotate(s.a);
  ctx.strokeStyle="red";
  ctx.beginPath();
  ctx.arc(0,0,s.r,0,Math.PI*2);
  ctx.stroke();
  ctx.restore();

  // near miss slow-mo
  if(Math.abs((s.y+s.r)-p.y)<3){
   slow=0.35;setTimeout(()=>slow=1,120);
   streak++;
  }

  if(
   s.x<p.x+p.w && s.x+s.r*2>p.x &&
   s.y<p.y+p.h && s.y+s.r*2>p.y
  ) endGame();

  if(s.y>c.height){
   saws.splice(i,1);
   score++;streak++;
  }
 });

 document.getElementById("score").innerText="Score: "+score;
 document.getElementById("streak").innerText="ðŸ”¥ Streak: "+streak;
 requestAnimationFrame(loop);
}

setInterval(spawn,650);
loop();

/* ================= END ================= */
function endGame(){
 running=false;
 document.body.style.background="#400";
 setTimeout(()=>document.body.style.background="",200);

 let close="";
 if(best-score<=3 && score<best) close=" â€” SO CLOSE!";
 if(score>best){
  best=score;
  localStorage.setItem("best",best);
 }

 document.getElementById("final").innerText=
  `Score ${score} / Best ${best}${close} | ${rank(score)}`;
 document.getElementById("panel").style.display="block";
}

/* ================= MONEY ================= */
function continueAd(){
 if(saveUsed) return restart();
 saveUsed=true;
 if(!PF) return restart();
 PF.showRewardedAd(()=>{
  saws=[];running=true;
  document.getElementById("panel").style.display="none";
  loop();
 });
}

function cashOut(){
 if(PF){
  PF.addPoints(score);
  PF.endGame();
 }
 restart();
}

function risk(m,c){
 if(Math.random()<c){score*=m;cashOut();}
 else restart();
}

function restart(){
 score=0;streak=0;saws=[];
 saveUsed=false;
 running=true;
 document.getElementById("panel").style.display="none";
 loop();
}

/* ================= VIRAL ================= */
function rank(s){
 if(s>100)return"TOP 1%";
 if(s>70)return"TOP 5%";
 if(s>40)return"TOP 15%";
 if(s>20)return"TOP 35%";
 return"TOP 60%";
}

function share(){
 const t=`I survived ${score} in Dodge Arena ðŸ˜ˆ Can you beat me?`;
 navigator.share?
 navigator.share({text:t}):
 navigator.clipboard.writeText(t);
}
</script>

</body>
</html>