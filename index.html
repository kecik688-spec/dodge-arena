<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Moody Idle 3D ‚Äî Vibe Engine</title>

<meta name="x-ogp-key" content="9063cd14-6bfe-4820-964a-0194b9ac0569">
<script src="https://sdk.play.fun/opus.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<style>
html,body{
  margin:0;
  background:#05060c;
  overflow:hidden;
  font-family:system-ui;
  color:#fff;
}
#ui{
  position:fixed;
  top:12px;
  left:12px;
  z-index:10;
}
#ui div{margin-bottom:6px}
button{
  background:#ffb703;
  border:none;
  padding:6px 12px;
  border-radius:10px;
  font-weight:800;
  cursor:pointer;
}
#boss{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 20px;
  background:#ff0033;
  border-radius:16px;
  display:none;
  font-weight:800;
}
</style>
</head>
<body>

<div id="ui">
  <div id="pts">pts: 0</div>
  <div id="mood">üôÇ calm</div>
  <div id="mode">‚òÄÔ∏è day</div>
  <div id="streak">üî• streak: 1</div>
  <button onclick="boost()">BOOST</button>
</div>

<div id="boss">‚ö° LASER BOSS ACTIVE</div>

<script>
/* PLAY.FUN */
let pf=null;
window.onload=()=>{
  if(window.Opus){
    pf=new Opus({widgets:{points:true}});
  }
};

/* THREE */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,0.1,100);
camera.position.z=5;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* LIGHT */
scene.add(new THREE.AmbientLight(0x404040));
const light=new THREE.PointLight(0xffffff,1.4);
light.position.set(3,3,5);
scene.add(light);

/* ORB */
const geo=new THREE.SphereGeometry(1,64,64);
const mat=new THREE.MeshStandardMaterial({
  color:0x6ef3c5,
  roughness:0.2,
  metalness:0.15,
  emissive:0x000000
});
const orb=new THREE.Mesh(geo,mat);
scene.add(orb);

/* EYES */
const eyeGeo=new THREE.SphereGeometry(0.08,16,16);
const eyeMat=new THREE.MeshBasicMaterial({color:0x000000});
const e1=new THREE.Mesh(eyeGeo,eyeMat);
const e2=new THREE.Mesh(eyeGeo,eyeMat);
e1.position.set(-0.25,0.15,0.9);
e2.position.set(0.25,0.15,0.9);
orb.add(e1,e2);

/* UI */
const ptsEl=pts;
const moodEl=mood;
const modeEl=mode;
const streakEl=streak;
const bossEl=boss;

/* STATE */
let score=0, buffer=0, t=0;
let boostT=0;
let night=false;
let bossT=0;
let streak=1;

/* MOODS */
const moods=[
 {n:"calm",e:"üôÇ",c:0x6ef3c5,m:1},
 {n:"sleepy",e:"üò¥",c:0x8ecae6,m:1},
 {n:"happy",e:"üòÑ",c:0xffe066,m:1.3},
 {n:"GOLDEN",e:"‚ú®",c:0xffd700,m:5,r:1}
];
let moodC=moods[0];

function boost(){boostT=600}

/* RESIZE */
onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};

/* LOOP */
function loop(){
  requestAnimationFrame(loop);
  t++;

  /* DAY/NIGHT */
  if(t%3600===0){
    night=!night;
    document.body.style.background=night?"#01020a":"#05060c";
  }
  modeEl.innerText=night?"üåô night":"‚òÄÔ∏è day";

  /* MOOD */
  if(t%900===0){
    moodC=Math.random()<0.01?moods[3]:moods[Math.floor(Math.random()*3)];
    mat.color.setHex(moodC.c);
  }
  moodEl.innerText=moodC.e+" "+moodC.n;

  /* BOSS */
  if(t%3000===0){
    bossT=900;
    bossEl.style.display="block";
    mat.emissive.setHex(0xff0033);
  }
  if(bossT>0){
    bossT--;
    if(bossT===0){
      bossEl.style.display="none";
      mat.emissive.setHex(0x000000);
      score+=100;
      if(pf) pf.addPoints(100);
    }
  }

  /* EARN */
  let earn=0.05*moodC.m*(night?1.5:1)*(boostT>0?2:1);
  if(boostT>0) boostT--;
  score+=earn;
  score|=0;
  ptsEl.innerText="pts: "+score;

  buffer+=earn;
  if(buffer>=10){
    if(pf) pf.addPoints(10);
    buffer=0;
  }

  /* STREAK */
  if(t%7200===0){streak++; streakEl.innerText="üî• streak: "+streak}

  /* ANIM */
  orb.rotation.y+=0.003;
  orb.scale.setScalar(1+Math.sin(t*0.05)*0.04);

  renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>