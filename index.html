<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dodge Arena: Double or Die</title>
<style>
body { margin:0; overflow:hidden; background:#0f0f0f; color:white; font-family:Arial }
#score { position:absolute; top:10px; left:10px; font-size:20px }
#panel {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%);
  display:none; text-align:center;
}
button {
  padding:12px 25px;
  font-size:18px;
  margin:10px;
  cursor:pointer;
}
#leaderboard {
  position:absolute;
  right:10px;
  top:10px;
  font-size:14px;
}
</style>
</head>
<body>

<div id="score">Score: 0</div>
<div id="leaderboard"></div>

<div id="panel">
<h1>Game Over</h1>
<p id="finalScore"></p>
<button onclick="cashOut()">üí∞ Cash Out</button>
<button onclick="doubleRisk()">üî• Risk x2</button>
<br>
<button onclick="restart()">Play Again</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: canvas.width/2 - 20, y: canvas.height - 60, w:40, h:40 };
let blocks = [];
let score = 0;
let gameRunning = true;
let speedMultiplier = 1;

let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

document.addEventListener("mousemove", e => {
  player.x = e.clientX - player.w/2;
});

function spawnBlock(){
  blocks.push({
    x: Math.random() * (canvas.width - 30),
    y: -30,
    w:30,
    h:30,
    speed: (3 + score/30) * speedMultiplier
  });
}

function update(){
  if(!gameRunning) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="lime";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  ctx.fillStyle="red";
  blocks.forEach((b,i)=>{
    b.y += b.speed;
    ctx.fillRect(b.x,b.y,b.w,b.h);

    if(
      b.x < player.x + player.w &&
      b.x + b.w > player.x &&
      b.y < player.y + player.h &&
      b.y + b.h > player.y
    ){
      endGame();
    }

    if(b.y > canvas.height){
      blocks.splice(i,1);
      score++;
      document.getElementById("score").innerText="Score: "+score;
    }
  });

  requestAnimationFrame(update);
}

function endGame(){
  gameRunning=false;
  document.getElementById("panel").style.display="block";
  document.getElementById("finalScore").innerText="Your Score: "+score;
}

function cashOut(){
  saveScore(score);
  sendScoreToPlayFun(score);
  restart();
}

function doubleRisk(){
  if(Math.random() < 0.5){
    score *= 2;
    alert("üî• SUCCESS! Score Doubled!");
    saveScore(score);
    sendScoreToPlayFun(score);
  } else {
    alert("üíÄ Failed! Score Lost!");
  }
  restart();
}

function restart(){
  blocks=[];
  score=0;
  speedMultiplier=1;
  gameRunning=true;
  document.getElementById("score").innerText="Score: 0";
  document.getElementById("panel").style.display="none";
  update();
}

function saveScore(s){
  leaderboard.push(s);
  leaderboard.sort((a,b)=>b-a);
  leaderboard = leaderboard.slice(0,5);
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  renderLeaderboard();
}

function renderLeaderboard(){
  let html="<b>Top 5</b><br>";
  leaderboard.forEach((s,i)=>{
    html += (i+1)+". "+s+"<br>";
  });
  document.getElementById("leaderboard").innerHTML=html;
}

function sendScoreToPlayFun(s){
  // üëá –í–°–¢–ê–í–ò –°–Æ–î–ê SDK
  // PlayFun.addPoints(s);
  // PlayFun.endGame();
}

setInterval(spawnBlock,800);
renderLeaderboard();
update();
</script>

</body>
</html>