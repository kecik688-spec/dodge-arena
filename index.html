<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Moody Idle ‚Äî Nightfall</title>

<meta name="x-ogp-key" content="9063cd14-6bfe-4820-964a-0194b9ac0569">
<script src="https://sdk.play.fun/opus.js"></script>

<style>
html,body{
  margin:0;
  background:#0b0d13;
  color:#fff;
  font-family:system-ui;
  overflow:hidden;
  transition:background 1s;
}
#ui{
  position:fixed;
  top:12px;
  left:12px;
  z-index:10;
  font-size:14px;
}
#ui div{margin-bottom:6px;opacity:.9}
button{
  background:#ffb703;
  border:none;
  padding:6px 12px;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
}
#boss{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#ff0033;
  padding:10px 18px;
  border-radius:14px;
  display:none;
  font-weight:700;
}
canvas{display:block;}
</style>
</head>
<body>

<div id="ui">
  <div id="pts">pts: 0</div>
  <div id="mood">üôÇ calm</div>
  <div id="mode">‚òÄÔ∏è day</div>
  <button onclick="boost()">BOOST</button>
</div>

<div id="boss">üëπ BOSS EVENT!</div>
<canvas id="c"></canvas>

<script>
/* SDK */
let playfun=null;
window.onload=()=>{
  if(window.Opus){
    playfun=new Opus({widgets:{points:true}});
  }
};

/* Canvas */
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();onresize=resize;

/* UI */
const ptsEl=document.getElementById("pts");
const moodEl=document.getElementById("mood");
const modeEl=document.getElementById("mode");
const bossEl=document.getElementById("boss");

/* State */
let score=0, buffer=0, t=0;
let boostTimer=0;
let isNight=false;
let bossTimer=0;

/* Moods */
const moods=[
  {name:"calm",emoji:"üôÇ",color:"#6ef3c5",mult:1},
  {name:"happy",emoji:"üòÑ",color:"#ffe066",mult:1.2},
  {name:"sleepy",emoji:"üò¥",color:"#8ecae6",mult:1},
  {name:"stressed",emoji:"üòµ",color:"#ff6b6b",mult:0.8},
  {name:"GOLDEN",emoji:"‚ú®",color:"#ffd700",mult:5,rare:true}
];
let mood=moods[0];

/* Boost */
function boost(){boostTimer=600}

/* Loop */
function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,c.width,c.height);
  t++;

  /* Day / Night */
  if(t%3600===0){
    isNight=!isNight;
    document.body.style.background=isNight?"#05070d":"#0b0d13";
  }
  modeEl.innerText=isNight?"üåô night":"‚òÄÔ∏è day";

  /* Mood change */
  if(t%800===0){
    if(Math.random()<0.01){
      mood=moods.find(m=>m.rare);
    }else{
      mood=moods[Math.floor(Math.random()*(moods.length-1))];
    }
  }

  /* Boss event */
  if(t%3000===0){
    bossTimer=900;
    bossEl.style.display="block";
  }
  if(bossTimer>0){
    bossTimer--;
    if(bossTimer===0){
      bossEl.style.display="none";
      score+=50;
      if(playfun) playfun.addPoints(50);
    }
  }

  /* Earnings */
  let earn=0.05*mood.mult;
  if(isNight) earn*=1.5;
  if(boostTimer>0){earn*=2;boostTimer--;}

  score+=earn;
  score|=0;
  ptsEl.innerText="pts: "+score;
  moodEl.innerText=mood.emoji+" "+mood.name;

  buffer+=earn;
  if(buffer>=10){
    if(playfun) playfun.addPoints(10);
    buffer=0;
  }

  /* Draw Moody */
  const x=c.width/2,y=c.height/2;
  const r=80+Math.sin(t*0.04)*4;

  ctx.beginPath();
  ctx.arc(x,y,r,0,6.28);
  ctx.fillStyle=mood.color;
  ctx.fill();

  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(x-22,y-10,6,0,6.28);
  ctx.arc(x+22,y-10,6,0,6.28);
  ctx.fill();

  ctx.strokeStyle="#000";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.arc(x,y+14,22,0,Math.PI);
  ctx.stroke();
  ctx.lineWidth=1;
}
loop();
</script>
</body>
</html>