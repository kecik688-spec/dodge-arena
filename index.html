<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- âœ… Claim Ownership -->
<meta name="x-ogp-key" content="9063cd14-6bfe-4820-964a-0194b9ac0569" id="ogp-key-meta" />

<title>Dodge Arena: Double or Die</title>

<!-- âœ… Play.fun SDK -->
<script src="https://play.fun/sdk.js"></script>

<style>
body {
  margin:0;
  overflow:hidden;
  background:#0f0f0f;
  color:#fff;
  font-family:Arial;
}
#score { position:absolute; top:10px; left:10px; font-size:20px }
#best { position:absolute; top:40px; left:10px; font-size:14px; opacity:.7 }

#panel {
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:#111;
  padding:20px;
  text-align:center;
  display:none;
  border-radius:12px;
}
button {
  padding:14px 26px;
  margin:6px;
  font-size:16px;
  cursor:pointer;
  border:none;
  border-radius:8px;
}
.continue { background:#2ecc71; color:#000 }
.risk { background:#e67e22 }
.cash { background:#3498db }
</style>
</head>

<body>

<div id="score">Score: 0</div>
<div id="best">Best: 0</div>

<div id="panel">
  <h2>Game Over</h2>
  <p id="final"></p>

  <!-- ðŸ’° Ð´ÐµÐ½ÑŒÐ³Ð¸ -->
  <button class="continue" onclick="watchAd()">ðŸ“º Continue</button><br>

  <!-- ðŸ”¥ Ð°Ð´Ð´Ð¸ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ -->
  <button class="risk" onclick="risk(2,0.7)">x2 (70%)</button>
  <button class="risk" onclick="risk(4,0.4)">x4 (40%)</button>
  <button class="risk" onclick="risk(8,0.2)">x8 (20%)</button><br>

  <button class="cash" onclick="cashOut()">ðŸ’° Cash Out</button>
  <br><br>
  <button onclick="restart()">Play Again</button>
</div>

<canvas id="game"></canvas>

<script>
/* =======================
   PLAY.FUN INIT
======================= */
const PF = window.PlayFun || null;
if (PF) PF.startGame();

/* =======================
   GAME STATE
======================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let player = { x: canvas.width/2-20, y: canvas.height-60, w:40, h:40 };
let blocks = [];
let score = 0;
let running = true;

let best = localStorage.getItem("best") || 0;
document.getElementById("best").innerText = "Best: " + best;

/* =======================
   INPUT
======================= */
document.addEventListener("mousemove", e=>{
  player.x = e.clientX - player.w/2;
});
document.addEventListener("touchmove", e=>{
  player.x = e.touches[0].clientX - player.w/2;
});

/* =======================
   GAME LOOP
======================= */
function spawn(){
  blocks.push({
    x: Math.random()*(canvas.width-30),
    y: -30,
    w:30, h:30,
    s: 3 + score*0.05
  });
}

function loop(){
  if(!running) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="lime";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  ctx.fillStyle="red";
  blocks.forEach((b,i)=>{
    b.y += b.s;
    ctx.fillRect(b.x,b.y,b.w,b.h);

    // near miss
    if(Math.abs((b.y+b.h)-player.y)<3){
      score++;
    }

    if(
      b.x<player.x+player.w &&
      b.x+b.w>player.x &&
      b.y<player.y+player.h &&
      b.y+b.h>player.y
    ) end();
    
    if(b.y>canvas.height){
      blocks.splice(i,1);
      score++;
    }
  });

  document.getElementById("score").innerText="Score: "+score;
  requestAnimationFrame(loop);
}

setInterval(spawn,700);
loop();

/* =======================
   GAME OVER
======================= */
function end(){
  running=false;
  if(score>best){
    best=score;
    localStorage.setItem("best",best);
    document.getElementById("best").innerText="Best: "+best;
  }
  document.getElementById("panel").style.display="block";
  document.getElementById("final").innerText="Score: "+score;
}

/* =======================
   MONETIZATION
======================= */
function watchAd(){
  if(!PF) return restart();
  PF.showRewardedAd(()=>{
    blocks=[];
    running=true;
    document.getElementById("panel").style.display="none";
    loop();
  });
}

function cashOut(){
  if(PF){
    PF.addPoints(score);
    PF.endGame();
  }
  restart();
}

function risk(m,c){
  if(Math.random()<c){
    score*=m;
    cashOut();
  } else {
    restart();
  }
}

function restart(){
  score=0;
  blocks=[];
  running=true;
  document.getElementById("panel").style.display="none";
  loop();
}
</script>

</body>
</html>
